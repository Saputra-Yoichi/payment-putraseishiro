<!doctype html>
<html lang="id">  
<head>  
<meta charset="utf-8">  
<meta name="viewport" content="width=device-width, initial-scale=1">  
<title>FAYY PAYMENT</title>  
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&display=swap" rel="stylesheet">  
<style>  
:root{  
  --bg:#e6dfd1;  
  --panel:rgba(255,255,255,.78);  
  --text:#2d261b;  
  --border:#c8b79d;  
  --box:rgba(255,255,255,.88);  
}  
  
.copy-btn{  
  margin-top:10px;  
}  
  
.qris-img{  
  max-width: 100%;  
  width: 260px;  
  height: auto;  
  display: block;  
  margin: 0 auto;  
}  
  
.hidden{display:none}  
  
.status{  
  text-align:center;  
  margin-top:10px;  
  font-weight:600;  
}  
  
#paymentInfo{  
  margin-top:15px;  
  padding:12px;  
  border-radius:12px;  
  border:1px dashed var(--border);  
  text-align:center;  
  display:none;  
}  
  
body.dark{  
  --bg:#0e0e11;  
  --panel:rgba(20,20,25,.85);  
  --text:#e7dcc6;  
  --border:#6f5b3e;  
  --box:rgba(25,25,32,.9);  
}  
select,input,button{  
  width:100%;  
  padding:10px;  
  margin-top:10px;  
  border-radius:10px;  
  border:1px solid var(--border);  
  font-family:inherit;  
}  
  
button{  
  cursor:pointer;  
  background:transparent;  
  font-weight:600;  
  color: var(--text);  
}  
  
button:hover{  
  background:rgba(0,0,0,.05);  
}  
  
/* BASE */  
body{  
  margin:0;  
  font-family:'Cinzel',serif;  
  background:var(--bg) url('https://files.catbox.moe/6sdawf.jpg') center/cover no-repeat fixed;  
  color:var(--text);  
  transition:.3s;  
}  
.container{  
  max-width:900px;  
  margin:40px auto;  
  padding:35px;  
  background:var(--panel);  
  border-radius:18px;  
  border:1px solid var(--border);  
  box-shadow:0 14px 30px rgba(0,0,0,.35);  
}  
h1{text-align:center;margin-bottom:5px}  
  
/* TOGGLE */  
.toggle{  
  text-align:center;  
  margin-bottom:10px;  
}  
.toggle button{  
  padding:8px 18px;  
  border-radius:20px;  
  border:1px solid var(--border);  
  background:transparent;  
  color:var(--text);  
  cursor:pointer;  
  font-family:inherit;  
}  
  
/* SLIDER */  
.pages{  
  display:flex;  
  overflow-x:auto;  
  scroll-snap-type:x mandatory;  
  scroll-behavior:smooth;  
}  
.pages::-webkit-scrollbar{display:none}  
.page{  
  min-width:100%;  
  scroll-snap-align:start;  
}  
  
/* DOTS */  
.dots{  
  display:flex;  
  justify-content:center;  
  gap:10px;  
  margin:10px 0 20px;  
}  
.dot{  
  width:10px;  
  height:10px;  
  border-radius:50%;  
  background:var(--border);  
  opacity:.4;  
  cursor:pointer;  
  transition:.3s;  
}  
.dot.active{  
  opacity:1;  
  transform:scale(1.3);  
}  
  
/* CONTENT */  
.section-title{  
  text-align:center;  
  font-size:22px;  
  margin:25px 0 20px;  
  border-bottom:2px solid var(--border);  
  padding-bottom:10px;  
}  
.price-box{  
  background:var(--box);  
  border:1px solid var(--border);  
  padding:16px;  
  border-radius:14px;  
  margin:12px 0;  
  text-align:center;  
  box-shadow:0 6px 16px rgba(0,0,0,.2);  
  transition:.3s;  
  cursor: pointer;  
}  
.price-box:hover{  
  transform:translateY(-4px);  
}  
  
/* PAYMENT */  
.pay-box{  
  text-align:center;  
  padding:22px;  
  margin-top:25px;  
  background:var(--box);  
  border:1px solid var(--border);  
  border-radius:16px;  
}  
  
/* HISTORY */  
.history-section{  
  margin-top:30px;  
}  
.tx-item{  
  background:var(--box);  
  border:1px solid var(--border);  
  padding:15px;  
  margin:10px 0;  
  border-radius:12px;  
  text-align:left;  
}  
.tx-id{  
  font-weight:600;  
  font-size:16px;  
  margin-bottom:8px;  
}  
.tx-details{  
  font-size:14px;  
  line-height:1.4;  
}  
  
/* RESPONSIVE */  
@media (max-width:768px){  
  .container{padding:20px;}  
}  
</style>  
</head>  
<body>  
<div class="container">  
  <h1>FAYY ‚Ä¢ PAYMENT</h1>  
  <div class="toggle">  
    <button onclick="toggleDark()">üåô Dark Mode</button>  
  </div>  
  <!-- AUDIO -->  
  <audio id="bgm" loop>  
    <source src="https://pomf2.lain.la/f/fsy0k39j.mp3" type="audio/mpeg">  
    Browser kamu tidak mendukung audio.  
  </audio>  
  <div style="text-align:center;margin-top:20px">  
    <button id="musicBtn" onclick="toggleMusic()"  
    style="padding:10px 22px;  
           border-radius:20px;  
           border:1px solid var(--border);  
           background:transparent;  
           font-family:inherit;  
           cursor:pointer;  
           color:var(--text);">  
    üéµ Play Song One In A Million  
    </button>  
  </div>  
  
  <section class="page">  
    <!-- FEE REKBER -->  
    <div class="section-title">üí∞ FEE MIDMAN / TRANSAKSI</div>  
    <div class="price-box">Rp0 ‚Äì Rp99.000 ‚Üí Fee Rp5.000</div>  
    <div class="price-box">Rp100.000 ‚Äì Rp199.000 ‚Üí Fee Rp10.000</div>  
    <div class="price-box">Rp200.000 ‚Äì Rp249.000 ‚Üí Fee Rp15.000</div>  
    <div class="price-box">Rp250.000 ‚Äì Rp399.000 ‚Üí Fee Rp20.000</div>  
    <div class="price-box">Rp400.000 ‚Äì Rp599.000 ‚Üí Fee Rp30.000</div>  
    <div class="price-box">Rp600.000 ‚Äì Rp999.000 ‚Üí Fee Rp40.000</div>  
    <div class="price-box">Rp1.000.000 ‚Äì Rp2.000.000 ‚Üí Fee Rp50.000</div>  
    <div class="price-box">‚îÅFEE BT/DELAY/TT‚îÅ</div>  
    <div class="price-box">MC Delay ‚Üí Fee Rp30.000</div>  
    <div class="price-box">Tukar Tambah ‚Üí Fee Rp30.000</div>  
    <div class="price-box">Barter ‚Üí Fee Rp30.000</div>  
    <div class="price-box">‚îÅJASA PENGAMANAN‚îÅ</div>  
    <div class="price-box">Jasa Pengamanan ‚Üí Fee Rp20.000</div>  
  </section>  
  
  <!-- DOT INDICATOR -->  
  <div class="dots">  
    <div class="dot active"></div>  
  </div>  
  
  <div class="pay-box">  
    <p style="text-align:center;font-weight:600">  
    Kode Transaksi: <span id="trxView"></span>  
    </p>  
    <input type="text" id="amount" placeholder="Nominal Transaksi (Rp)">  
    <div id="calcResult" style="margin-top:10px;font-weight:600"></div>  
    <select id="paymentMethod">  
      <option value="">-- Pilih --</option>  
      <option value="dana">üí∏ DANA</option>  
      <option value="gopay">üí∏ GOPAY</option>  
      <option value="qris">üì± QRIS All Payment</option>  
      <option value="mandiri">üè¶ MANDIRI</option>  
    </select>  
    <div id="paymentInfo"></div>  
    <button id="payBtn">üí≥ Klik Untuk Transfer</button>  
    <div id="uploadSection" class="hidden">  
      <div class="section-title">Upload Bukti</div>  
      <input type="text" id="note" placeholder="Usn Telegram / No Whatsapp">  
      <input type="text" id="product" placeholder="Nama Product">  
      <input type="file" id="fileInput" accept="image/*,application/pdf">  
      <img id="preview" style="max-width:100%;display:none;margin-top:10px;border-radius:12px">  
      <button id="sendBtn">üì§ Kirim Bukti</button>  
      <p id="statusText" class="status"></p>  
    </div>  
  </div>  
  
  <!-- HISTORY SECTION -->  
  <div class="history-section">  
    <div class="section-title">üìã Riwayat Transaksi</div>  
    <div id="recentTx" class="tx-list"></div>  
  </div>  
  
  <!-- KONTAK -->
  <div class="section-title">Kontak</div>  
  <p style="text-align:center;font-size:18px">  
  Admin WhatsApp:  
  <b>  
    <a href="https://wa.me/6285283355152" target="_blank" style="color:inherit;text-decoration:none;">  
      6285283355152 (FAYY)  
    </a>  
  </b>  
  </p>  
  <p style="text-align:center;font-size:18px">  
  Admin:  
  <b>  
    <a href="https://t.me/putraseishiro" target="_blank" style="color:inherit;text-decoration:none;">  
      @putraseishiro  
    </a>  
  </b>  
  </p> 
</div>  

<script>  
// ========== INIT HISTORY ON LOAD ==========  
window.addEventListener('load', () => {  
  loadHistory();  
});  

// ========== FEE CALCULATION ==========  
const amountInput = document.getElementById("amount");  
const calcResult = document.getElementById("calcResult");  

function getFee(n) {  
  if (n < 100000) return 5000;  
  if (n < 200000) return 10000;  
  if (n < 250000) return 15000;  
  if (n < 400000) return 20000;  
  if (n < 600000) return 30000;  
  if (n < 1000000) return 40000;  
  return 50000;  
}  

amountInput.addEventListener("input", () => {
  let raw = amountInput.value.replace(/[^0-9]/g, "");
  if (!raw) {
    calcResult.innerHTML = "";
    amountInput.value = "";
    return;
  }

  let val = parseInt(raw);
  if (isNaN(val) || val <= 0) return;

  const fee = getFee(val);
  const total = val + fee;

  amountInput.value = val.toLocaleString("id-ID");
  calcResult.innerHTML = `
    üí∞ Fee: Rp${fee.toLocaleString("id-ID")}<br>
    üßæ Total Transfer: <b>Rp${total.toLocaleString("id-ID")}</b>
  `;
});

// ========== TRX ID & PREVIEW ==========  
function generateTrxID() {  
  const d = new Date();  
  return `FAYY-${d.getFullYear()}${(d.getMonth()+1).toString().padStart(2,'0')}${d.getDate().toString().padStart(2,'0')}-${Math.floor(Math.random()*9000+1000)}`;  
}  
const TRX_ID = generateTrxID();  
document.getElementById("trxView").textContent = TRX_ID;  

const fileInput = document.getElementById("fileInput");  
const preview = document.getElementById("preview");  

fileInput.addEventListener("change", () => {  
  const file = fileInput.files[0];  
  if (file && file.type.startsWith("image/")) {  
    const reader = new FileReader();  
    reader.onload = e => {  
      preview.src = e.target.result;  
      preview.style.display = "block";  
    };  
    reader.readAsDataURL(file);  
  } else {  
    preview.style.display = "none";  
  }  
});  

// Price box click  
document.querySelectorAll(".price-box").forEach(box => {  
  box.addEventListener("click", () => {  
    document.getElementById("product").value = box.textContent.trim();  
    document.getElementById("uploadSection").classList.remove("hidden");  
  });  
});  

// ========== MUSIC ==========  
let playing = false;  
const bgm = document.getElementById("bgm");  
const musicBtn = document.getElementById("musicBtn");  

function toggleMusic() {  
  if (!playing) {  
    bgm.volume = 0.5;  
    bgm.play().then(() => {  
      playing = true;  
      musicBtn.textContent = "‚è∏ Pause Memories";  
    }).catch(e => console.log("Audio play failed:", e));  
  } else {  
    bgm.pause();  
    playing = false;  
    musicBtn.textContent = "üéµ Play Memories";  
  }  
}  

function toggleDark() {  
  document.body.classList.toggle("dark");  
}  

// ========== PAYMENT SYSTEM ==========  
const BOT_TOKEN = "7761334748:AAHmFWYGkEXtY1oQf64uJWDPfdPNMAWKHhI";  
const CHAT_ID = "-5038818436";  

const PAYMENT_DATA = {  
  dana: {  
    label: "üí∏ DANA",  
    number: "0821-1380-1890",  
    name: "FAYYY"  
  },  
  gopay: {  
    label: "üí∏ GOPAY",  
    number: "0852-8335-5152",  
    name: "FAYYY"  
  },  
  qris: {  
    label: "üì± QRIS All Payment",  
    qr: "https://files.catbox.moe/3hulmi.jpeg",  
    name: "MODDY STORE"  
  },   
  mandiri: {  
    label: "üè¶ MANDIRI",  
    number: "4616994895890566",  
    name: "FAYYY"  
  }  
};  

const paymentSelect = document.getElementById("paymentMethod");  
const paymentInfo = document.getElementById("paymentInfo");  
const payBtn = document.getElementById("payBtn");  
const uploadSection = document.getElementById("uploadSection");  
const sendBtn = document.getElementById("sendBtn");  
const statusText = document.getElementById("statusText");  

// Payment method change  
paymentSelect.addEventListener("change", () => {  
  const method = paymentSelect.value;  
  if (!method || !PAYMENT_DATA[method]) {  
    paymentInfo.style.display = "none";  
    return;  
  }  
  
  const p = PAYMENT_DATA[method];  
  paymentInfo.style.display = "block";  
  
  if (method === "qris") {  
    paymentInfo.innerHTML = `  
      <b style="font-size:18px">${p.label}</b><br><br>  
      <img src="${p.qr}" class="qris-img" style="border-radius:14px"><br><br>  
      <b>Atas Nama:</b> ${p.name}<br>  
      <small>Scan pakai DANA / OVO / Gopay / ShopeePay / Mobile Banking</small>  
    `;  
  } else {  
    paymentInfo.innerHTML = `  
      <b style="font-size:18px">${p.label}</b><br><br>  
      Nomor: <b>${p.number}</b><br>  
      Atas Nama: <b>${p.name}</b><br>  
      <button class="copy-btn" onclick="copyNumber('${p.number}')">  
        üìã Copy Nomor  
      </button>  
    `;  
  }  
});  

function copyNumber(num) {  
  navigator.clipboard.writeText(num).then(() => {  
    alert("Nomor berhasil disalin!");  
  });  
}  

// Pay button  
payBtn.onclick = () => {  
  if (!paymentSelect.value) {  
    alert("Pilih metode pembayaran dulu!");  
    return;  
  }  
  uploadSection.classList.remove("hidden");  
  payBtn.textContent = "‚è≥ Menunggu Bukti";  
  paymentSelect.disabled = true;  
};  

// ========== HISTORY FUNCTIONS (BARU & LENGKAP) ==========  
function saveTx(data) {
  let history = JSON.parse(localStorage.getItem('txHistory') || '[]');
  history.unshift(data);
  history = history.slice(0, 5); // Max 5 terbaru
  localStorage.setItem('txHistory', JSON.stringify(history));
  updateRecentList(history);
}

function loadHistory() {
  const history = JSON.parse(localStorage.getItem('txHistory') || '[]');
  updateRecentList(history);
}

function updateRecentList(history) {
  const container = document.getElementById("recentTx");
  if (history.length === 0) {
    container.innerHTML = '<p style="text-align:center;color:var(--border);">Belum ada riwayat transaksi</p>';
    return;
  }
  
  container.innerHTML = history.map(tx => `
    <div class="tx-item">
      <div class="tx-id">${tx.id}</div>
      <div class="tx-details">
        üí∞ ${tx.method} ‚Ä¢ Rp${tx.amount}<br>
        üì¶ ${tx.product}<br>
        üïì ${tx.date}
      </div>
    </div>
  `).join('');
}

// ========== SEND BUTTON (DITAMBAH SAVE HISTORY) ==========  
sendBtn.onclick = async () => {  
  const note = document.getElementById("note").value.trim();  
  const product = document.getElementById("product").value.trim();  
  const rawAmount = amountInput.value.replace(/[^0-9]/g, "");
  
  if (!product) {  
    alert("Nama produk wajib diisi!");  
    return;  
  }  
  
  if (!rawAmount || parseInt(rawAmount) <= 0) {  
    alert("Nominal transaksi wajib diisi dan lebih dari 0!");  
    return;  
  }  
  
  if (!fileInput.files.length) {  
    alert("Pilih bukti pembayaran!");  
    return;  
  }  
  
  const file = fileInput.files[0];  
  const method = paymentSelect.value;  
  const p = PAYMENT_DATA[method];  
  const nomor = p.number ? p.number : "QRIS";  
  
  const amount = Number(rawAmount);
  const fee = getFee(amount);  
  const total = amount + fee;  
  
  const formData = new FormData();  
  formData.append("chat_id", CHAT_ID);  
  formData.append("caption", `üßæ Bukti Pembayaran  
üÜî ID: ${TRX_ID}  
üí∞ Metode: ${p.label}  
üí≥ Nomor: ${nomor}  
üë§ A/N: ${p.name}  
üì¶ Produk: ${product}  
üíµ Nominal: Rp${amount.toLocaleString("id-ID")}  
‚ûï Fee: Rp${fee.toLocaleString("id-ID")}  
üßÆ Total: Rp${total.toLocaleString("id-ID")}  
üìû Kontak: ${note || "-"}  
üïì ${new Date().toLocaleString("id-ID")}`);  
  
  const isImage = file.type.startsWith("image/");  
  formData.append(isImage ? "photo" : "document", file);  
  
  statusText.textContent = "‚è≥ Mengirim bukti...";  
  sendBtn.disabled = true;  
  
  try {  
    const res = await fetch(  
      `https://api.telegram.org/bot${BOT_TOKEN}/${isImage ? "sendPhoto" : "sendDocument"}`,  
      { method: "POST", body: formData }  
    );  
    const data = await res.json();  
    
    if (data.ok) {  
      statusText.textContent = "‚úÖ Bukti berhasil dikirim!";  
      statusText.style.color = "green";  
      
      // SIMPAN KE HISTORY ‚úÖ
      saveTx({
        id: TRX_ID,
        method: p.label,
        amount: amount.toLocaleString("id-ID"),
        product: product,
        date: new Date().toLocaleString("id-ID")
      });
      
      // Reset form  
      fileInput.value = "";  
      document.getElementById("note").value = "";  
      document.getElementById("product").value = "";  
      amountInput.value = "";  
      calcResult.innerHTML = "";  
      preview.style.display = "none";  
      payBtn.textContent = "üí≥ Klik Untuk Transfer";  
      paymentSelect.disabled = false;  
      paymentSelect.value = "";  
      paymentInfo.style.display = "none";  
      uploadSection.classList.add("hidden");  
      document.getElementById("trxView").textContent = generateTrxID(); // Generate TRX baru
    } else {  
      throw new Error(data.description || "Unknown error");  
    }  
  } catch (err) {  
    statusText.textContent = "‚ùå Gagal: " + err.message;  
    statusText.style.color = "red";  
  } finally {  
    sendBtn.disabled = false;  
  }  
};  
</script>  
</body>  
</html>
